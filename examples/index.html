<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="fonts/gamefont.css">
    <title>Base</title>
</head>
<body style="background-color: black; margin: 0;">

<script>
  const ipcRenderer = require('electron').ipcRenderer;
  const LoadManager = require('../src/loadManager');
  LoadManager.pathDir = 'res';
  ipcRenderer.send('show-dev');
  require('../src/lib/pixi');
  const RGUI = require('../src/rgui');
  const Input = RGUI.Input;

  const renderer = PIXI.autoDetectRenderer(1280, 720, {backgroundColor : 0x000000, resolution: 1});
  document.body.appendChild(renderer.view);
  RGUI.init();

  function scaleToWindow (view) {
    view.style.position = "absolute";
    view.style.width = window.innerWidth + "px";
    view.style.height = window.innerHeight + "px";
    view.style.display = "block";
  }

  scaleToWindow(renderer.view);

  window.addEventListener('resize', () => { scaleToWindow(renderer.view) });

  let stage = new PIXI.Container();

  let bg = new RGUI.ImageBox({
    x: 0,
    y: 0,
    width: 1280,
    height: 720,
    type: 0,
    focus: true,
    image: 'bg'
  });

  let image = new RGUI.ImageBox({
    x: 100,
    y: 100,
    width: 400,
    height: 400,
    type: 0,
    focus: true,
    image: 'test'
  });

  image.eventManager.on('Right', {}, ()=>{ image.xScroll(5) });
  image.eventManager.on('Down', {}, ()=>{ image.yScroll(5) });
  image.eventManager.on('Left', {}, ()=>{ image.xScroll(-5) });
  image.eventManager.on('Up', {}, ()=>{ image.yScroll(-5) });
  image.eventManager.on('A', {}, ()=>{ image.x -= 10 });
  image.eventManager.on('D', {}, ()=>{ image.x += 10 });
  image.eventManager.on('W', {}, ()=>{ image.y -= 10 });
  image.eventManager.on('S', {}, ()=>{ image.y += 10 });
  image.eventManager.on('changeX', {}, ()=>{
    if(image.x < 0 ) image.x = 0;
    if(image.x > 1280 - image.width) image.x = 1280 - image.width
  });
  image.eventManager.on('changeY', {}, ()=>{
    if(image.y < 0 ) image.y = 0;
    if(image.y > 720 - image.height) image.y = 720 - image.height
  });

  let button = new RGUI.SpriteButton({
    x: 20,
    y: 40,
    width: 26,
    height: 40,
    images: 'btn',
    i18nLoad: false
  });

  let label = new RGUI.Label({
    x:123,
    y:234,
    text:'你好啊 2333！'
  });

  let bar = new RGUI.ProgressBar({
    x:200,
    y:30,
    width: 200,
    height: 40
  });

  let cont = new RGUI.Container({x:0, y:0, width:1280, height: 720});
  cont.push(bg, image, button, label, bar);

  cont.controls.forEach((o)=>{
    console.log(o, o.uID);
    o.eventManager.on('down:MouseLeft', {}, (_, info)=>{console.log(_.obj.uID, info)})
  });

  stage.addChild(cont);

  animate();

  function animate() {
    requestAnimationFrame(animate);
    if(Input.keyDown('F10')) {
      ipcRenderer.send('show-dev');
      Input.clear()
    }
    cont.update();
    renderer.render(stage);
    Input.update();
  }

</script>

</body>
</html>