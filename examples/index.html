<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Base</title>
</head>
<body style="background-color: black; margin: 0;">

<script>
  let ipcRenderer = require('electron').ipcRenderer;

  require('../lib/pixi');
  const Bitmap = require('./js/bitmap');
  const Sprite = require('./js/sprite');
  const RGUI = require('../src/rgui');
  const Input = require('../src/input');

  let renderer = PIXI.autoDetectRenderer(1280, 720, {backgroundColor : 0x000000, resolution: 1});
  document.body.appendChild(renderer.view);

  function scaleToWindow (view) {
    view.style.position = "absolute";
    view.style.width = window.innerWidth + "px";
    view.style.height = window.innerHeight + "px";
    view.style.display = "block";
  }

  scaleToWindow(renderer.view);

  window.addEventListener('resize', () => { scaleToWindow(renderer.view) });

  let stage = new PIXI.Container();
  RGUI.init();

  ipcRenderer.send('show-dev');

  let bg = new RGUI.ImageBox({
    x: 0,
    y: 0,
    width: 1280,
    height: 720,
    type: 0,
    focus: true,
    image: Bitmap.load('./res/bg.png')
  });

  let image = new RGUI.ImageBox({
    x: 100,
    y: 100,
    width: 400,
    height: 400,
    type: 0,
    focus: true,
    image: Bitmap.load('./res/test.png')
  });

  image.eventManager.on('A', {}, ()=>{ image.x -= 10 });
  image.eventManager.on('D', {}, ()=>{ image.x += 10 });
  image.eventManager.on('W', {}, ()=>{ image.y -= 10 });
  image.eventManager.on('S', {}, ()=>{ image.y += 10 });

  let button = new RGUI.Button({
    x: 30,
    y: 168,
    width: 158,
    height: 60,
    text: '人物'
  });

  button.eventManager.on('click', {}, function () {
    image.type = image.type == 1 ? 0 : 1;
  });

  stage.addChild(bg);
  stage.addChild(image);
  stage.addChild(button);
  animate();

  function animate() {
    requestAnimationFrame(animate);
    if(Input.keyDown('F10')) {
      ipcRenderer.send('show-dev');
      Input.clear()
    }
    bg.update();
    button.update();
    image.update();
    renderer.render(stage);
    Input.update();
  }

</script>

</body>
</html>